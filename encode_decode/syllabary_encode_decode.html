<html>
<head>
<TITLE>Syllabary</TITLE>
<link rel="shortcut icon" href="Bicon16_alt2.ico">

<script type="text/javascript">

var line_len = 65;

var english_basic_key = ["A","1","AL","AN","AND","AR","ARE","AS","AT","ATE",
"ATI","B","2","BE","C","3","CA","CE","CO","COM",
"D","4","DA","DE","E","5","EA","ED","EN","ENT",
"ER","ERE","ERS","ES","EST","F","6","G","7","H",
"8","HAS","HE","I","9","IN","ING","ION","IS","IT",
"IVE","J","0","K","L","LA","LE","M","ME","N",
"ND","NE","NT","O","OF","ON","OR","OU","P","Q",
"R","RA","RE","RED","RES","RI","RO","S","SE","SH",
"ST","STO","T","TE","TED","TER","TH","THE","THI","THR",
"TI","TO","U","V","VE","W","WE","X","Y","Z"]

var french_basic_key = ["A","1","AI","AIS","AIT","AN","ANS","AR","AS","B",
"2","C","3","CE","D","4","DAN","DE","DEL","DES",
"DU","E","5","ED","EDE","EL","ELL","EM","EME","EN",
"ENT","ER","ES","ESE","EST","EUR","F","6","G","7",
"GE","H","8","I","9","IE","ION","IT","J","0",
"K","L","LA","LE","LES","LLE","M","ME","MEN","N",
"NE","NO","NON","NS","NT","O","ON","ONT","OU","OUI",
"OUR","OUS","P","PAR","Q","QU","QUE","QUI","R","RE",
"RES","S","SE","SSE","T","TE","TI","TIO","TRE","TTE",
"U","UI","UN","UNE","UR","V","W","X","Y","Z"];

var german_basic_key = ["A","1","AB","AHT","ALS","AM","AN","AU","AUF","B",
"2","BE","BEN","BER","C","3","CH","CHE","CHT","D",
"4","DA","DE","DEN","DER","DES","DI","DIE","DU","E",
"5","EI","EIN","EL","EN","END","ER","F","6","G",
"7","GE","GEN","H","8","HA","HE","HEN","I","9",
"ICH","IE","IN","ISC","IST","IT","J","0","K","L",
"M","MI","MIT","N","ND","NDE","NE","NO","NS","NUR",
"O","OB","P","Q","R","RCH","RE","S","SCH","SE",
"ST","T","TE","TEN","U","UE","UM","UN","UND","UNG",
"V","VON","W","WAR","WAS","WO","X","Y","Z","ZU"];

var italian_basic_key = ["A","1","AL","AN","AR","ATO","B","2","C","3",
"CA","CHE","CI","CO","D","4","DA","DE","DI","E",
"5","EL","EN","ER","ES","ET","F","6","G","7",
"GI","H","8","I","9","IA","IC","IL","IN","ION",
"IS","IT","J","0","K","L","LA","LE","LI","LL",
"LO","M","MA","ME","MI","MO","N","NA","NE","NI",
"NO","NTE","O","OL","ON","OR","OS","P","PA","PER",
"PR","Q","QU","R","RA","RE","RI","RO","S","SA",
"SE","SI","SO","SS","ST","T","TA","TE","TI","TO",
"TR","TT","U","UN","V","W","X","Y","Z","ZIO"];

var spanish_basic_key = ["A","1","AD","ADO","AL","AQU","AR","ARA","AS","B",
"2","C","3","CI","CIO","CO","CON","D","4","DE",
"DEL","DI","E","5","EDE","EL","EN","ER","ES","EST",
"F","6","G","7","H","8","HAY","I","9","IO",
"IST","J","0","K","L","LA","LAS","LO","LOS","M",
"MAS","ME","MI","MUY","N","NEI","NO","NON","NTE","O",
"ON","OR","OS","OSA","P","PER","POR","Q","QU","QUE",
"R","RA","RE","RES","S","SDE","SE","SER","SI","SIN",
"SON","ST","SU","SUS","T","TA","TE","TI","TU","U",
"UE","UN","UNA","UNO","V","VA","W","X","Y","Z"];

var latin_basic_key = ["A", "1", "AD", "AE", "AM", "ANT", "AS", "AT", "ATI", "ATU",
"B", "2", "BUS", "C", "3", "CON", "CUM", "D", "4", "E",
"5", "EM", "ENT", "EQU", "ER", "ERA", "ERI", "ES", "ET", "EX",
"F", "6", "G", "7", "H", "8", "I", "9", "IA", "IBU",
"IN", "IO", "ION", "IS", "ISS", "IT", "ITA", "ITU", "J","0",
"K", "L", "M", "N", "NE", "NT", "O","OS","P","PER",
"PRO",'Q', "QUA", "QUE", "QUI", "QUO", "R", "RA", "RAT", "RE",
"RI", "RUM", "S", "SE", "SI", "SSE", "STR", "T", "TA", "TAT",
"TE", "TER", "TI", "TIS", "TO", "TUM", "TUR", "U","UA", "UI",
"UM", "UNT", "UR", "US", "UT", "V", "W", "X", "Y", "Z"];

var basic_key = english_basic_key;

var digit_letters = 'ABCDEFGHIJ'
var digits = '0123456789'

function alltrim(str) { // remove leading and trailing blanks
	return str.replace(/^\s+|\s+$/g, '');
}

function condense_white_space(str) { // replace sequences of 1 or more space characters by single blanks
	return str.replace(/\s+/g, ' ');
}

function randomvalue(low, high) { return Math.floor(Math.random() * (1 + high - low) + low); }

function get_key_square(key,basic_key){
    var keysq,used_sym,key_array;
    var c,n,indx,x,i
    var key_symbs;
    
    key = key.toUpperCase();
    key = alltrim(key);	
    key = condense_white_space(key);
    key_array = key.split(' ');
    used_sym = {};
    key_symbs = {};
    for (i=0;i<100;i++)
        key_symbs[basic_key[i]]=1;
    keysq = [];
    indx = 0;
    //for c in key_array:
    for (i=0; i< key_array.length;i++){
        c = key_array[i];
        if ( !(c in key_symbs) ){
            keysq = 'Your key symbol '+c+' is not in the keysquare!';
            return([keysq,false])
        }
        if (c in used_sym)
            continue;
        used_sym[c] = 1
        keysq[indx++]=c;
        x = digit_letters.indexOf(c);
        //if c in digit_letters:
        if (x != -1 && c.length == 1) { // need c.length == 1 to avoid flagging DE 
            //n = digit_letters.index(c)
            x = (x+1)%10
            //keysq.append(str(n))
            keysq[indx++] = digits.charAt(x);
            used_sym[digits.charAt(x)] =1;
        }
    }
    //for c in basic_key :
    for (i=0;i< basic_key.length;i++){
        c = basic_key[i];
        if (c in used_sym)
            continue;
        used_sym[c] = 1
        keysq[indx++]=c;
    }
    return( [keysq,true] )
}

function show_worksheet(keysq){
    var str,i,c,s,j;
    var row,col,n;
    var left_key,top_key,lk,tk,cnt;    

    lk = document.getElementById('left_key').value;  
    cnt = 0;
    left_key = [];
    for (i=0;i<lk.length;i++){
         n = digits.indexOf(lk.charAt(i));
         if (n != -1) {
            left_key[cnt++] = n;
         }
    }
    tk = document.getElementById('top_key').value;  
    cnt = 0;
    top_key = [];
    for (i=0;i<tk.length;i++){
         n = digits.indexOf(tk.charAt(i));
         if (n != -1) {
            top_key[cnt++] = n;
         }
    }
    str = "\n\nKeyblock:\n";
    str += '    ';
    
    for (i=0;i<10;i++)
        str += top_key[i]+'   ';
    str += '\n';
    for ( row=0;row<10;row++){
        str += left_key[row]+'   ';
        for (col = 0;col<10;col++){
            str += keysq[10*row+col];
            for (i=0;i<4-keysq[10*row+col].length;i++)
                str += ' ';
        }
        str += '\n';
    }
    return(str);
}

function break_pt(c) {
	switch(c) {
		case ' ':
		case ',':
		case '"':
			return 1
	}
	return 0
}

function do_format(keysq,code){
    var out_str, pos, limit;
    var inverse_left,inverse_top,lk,tk,cnt;   
    var plain,c,n,i,j,c1;
    var state,row,col;
    
    lk = document.getElementById('left_key').value;
    inverse_left = [0,0,0,0,0,0,0,0,0,0];
    cnt = 0;
    //for c in left_key:
    for (i=0;i<lk.length;i++){
         n = digits.indexOf(lk.charAt(i));
         if (n != -1) {
            inverse_left[n] = cnt;
            cnt += 1;
        }
    }
    //print inverse_left
    tk = document.getElementById('top_key').value;
    inverse_top = [0,0,0,0,0,0,0,0,0,0];
    cnt = 0;
    //for c in top_key:
    for (i=0;i<tk.length;i++){
         n = digits.indexOf(tk.charAt(i));
         if (n != -1) {
            inverse_top[n] = cnt;
            cnt += 1;
        }
    }
    out_str = '';
    state = 0;
    plain = '';
    cnt = 0;
    var code_line = '';
	for (i=0;i<code.length;i++){
		c = code.charAt(i);
		n = digits.indexOf(c);
		if ( n>=0) {
            if (state == 0) {
                row = inverse_left[n];
                state = 1;
                c1 = c;
            }
            else {
                col = inverse_top[n];
                plain += keysq[10*row+col]+'  ';
                code_line += c1+c;
                cnt += 2;
                for (j=0;j<keysq[10*row+col].length;j++){
                    code_line += ' ';
                    cnt++;
                }
                state = 0;
                if( cnt >= line_len) {
                    cnt = 0;
                    plain = plain.toLowerCase();
                    out_str += code_line+'\n';
                    out_str += plain + '\n';
                    code_line='';
                    plain = '';
                }
            }
        }
	}
    plain = plain.toLowerCase();
    out_str += code_line+'\n';
    out_str += plain + '\n';
    
    return(out_str);
}


function do_calc(){ // encode
	var str, alpha,codetext,c,n;
    var key,i,row,col;
    var s,state,c1,c2;
    var ftext, plaintext;
    var keysq, left_key,top_key,lk,tk,cnt;
    var n1,ns,indx,code;
    var di_flag,tr_flag;
    var inverse_left,inverse_top;
	
	alpha="ABCDEFGHIJKLMNOPQRSTUVWXYZ";
    key = document.getElementById('key_area').value;
    key = key.toUpperCase();
    if (key == ''){
        document.getElementById('output_area').value ="No key entered!";
        return;
    }
    str = get_key_square(key,basic_key)
    keysq =str[0];
    if ( str[1] == false) { // used non-keysquare symbols
        document.getElementById('output_area').value =keysq;
        return;
    }
    
    str = 'Keysquare:\n';
    for (n=0;n<keysq.length;n++){
        str += keysq[n]+' ';
    }
    lk = document.getElementById('left_key').value;
    // check for missing digits
    inverse_left = [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];
    cnt = 0;
    //for c in left_key:
    for (i=0;i<lk.length;i++){
         n = digits.indexOf(lk.charAt(i));
         if (n != -1) {
            inverse_left[n] = cnt;
            cnt += 1;
        }
    }
    for (i=0;i<10;i++) {
        if (inverse_left[i] == -1) {
            document.getElementById('output_area').value ='Digit '+i+' missing from row key';
            return;
        }
    }
    // get left key
    cnt = 0;
    left_key = [];
    for (i=0;i<lk.length;i++){
         n = digits.indexOf(lk.charAt(i));
         if (n != -1) {
            left_key[cnt++] = n;
         }
    }
    if (cnt != 10) {
        document.getElementById('output_area').value ="Row key does not have 10 digits!";
        return;
    }
    
    tk = document.getElementById('top_key').value; 
    // check for missing digits in top key
    inverse_top = [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];
    cnt = 0;
    //for c in top_key:
    for (i=0;i<tk.length;i++){
         n = digits.indexOf(tk.charAt(i));
         if (n != -1) {
            inverse_top[n] = cnt;
            cnt += 1;
        }
    }
    for (i=0;i<10;i++) {
        if (inverse_top[i] == -1) {
            document.getElementById('output_area').value ='Digit '+i+' missing from column key';
            return;
        }
    }
    // get top key
    cnt = 0;
    top_key = [];
    for (i=0;i<tk.length;i++){
         n = digits.indexOf(tk.charAt(i));
         if (n != -1) {
            top_key[cnt++] = n;
         }
    }
    if (cnt != 10) {
        document.getElementById('output_area').value ="Column key does not have 10 digits!";
        return;
    }
    
    //get singleton, digtraph and trigraph symbol
    var singleton = {}
    var digraph = {}
    var trigraph = {}
    //  for n in range(100):
    for (n=0;n<100;n++) {
        s = keysq[n];
        s = s.toLowerCase();
        row = Math.floor(n/10);
        col = n%10;
        n1 = 10*left_key[row]+top_key[col];
        ns = '';
        if (n1 < 10)
            ns = '0'+n1 ;
        else
            ns += n1;
        if (s.length == 1)
            singleton[s] = ns;
        else if (s.length==2)
            digraph[s]= ns
        else
            trigraph[s]=ns
    }
    var SING_FREQ = 50        
    var DI_FREQ = 80
    var symbols = 'abcdefghijklmnopqrstuivwxyz0123456789'

    plaintext = document.getElementById('input_area').value;
    plaintext = plaintext.toLowerCase();
    var plain_array = []
    cnt = 0;
    for (i=0;i<plaintext.length;i++) {
        c = plaintext.charAt(i);
        n = symbols.indexOf(c);
        if ( n != -1) 
            plain_array[cnt++] = c;
    }
    //encode
    indx = 0
    code = ''
    cnt = 0
    while (indx < plain_array.length){
        c = plain_array[indx];
        if (indx+1<plain_array.length)
            c1 = plain_array[indx+1];
        else
            c1 = '0' ;// not in any digraph or trigraph
        if (indx+2 < plain_array.length)
            c2 = plain_array[indx+2];
        else
            c2 = '0' ;
        if ( (c+c1) in digraph)
            di_flag = 1;
        else
            di_flag = 0;
        if ( (c+c1+c2) in trigraph)
            tr_flag = 1;
        else
            tr_flag = 0;
        if (tr_flag == 0 && di_flag == 0){
            code += singleton[c];
            indx += 1;
        }
        else if (tr_flag == 0 && di_flag == 1) {
            if (randomvalue(0,100) < SING_FREQ){
                code += singleton[c];
                indx += 1;
            }
            else {
                code += digraph[c+c1];
                indx += 2;
            }
        }
        else if (tr_flag == 1 && di_flag == 0) {
            if (randomvalue(0,100) < SING_FREQ) {
                code += singleton[c];
                indx += 1;
            }
            else {
                code += trigraph[c+c1+c2];
                indx += 3;
            }
        }
        else {
            n = randomvalue(0,100);
            if (n < SING_FREQ){
                code += singleton[c];
                indx += 1;
            }
            else if (n < DI_FREQ) {
                code += digraph[c+c1];
                indx += 2;
            }
            else {
                code += trigraph[c+c1+c2];
                indx += 3;
            }
        }
        code += ' '
        cnt += 1
        if (cnt == 22){
            cnt = 0;
            code += '\n';
        }
    }
    //print "ciphertext:"        
    //print code
    ftext = code;
    if ( document.getElementById('show_work').checked){    
        s = "\n\nKey: "+key;
        // show worksheet
        s += show_worksheet(keysq);
        s += '\n\nworksheet:\n';
        s += do_format(keysq,code)
        ftext += s;
    }
    
	document.getElementById('output_area').value = ftext;

}

function do_decrypt(){ // decode
	var str, alpha,codetext,c,n;
    var key,i,row,col;
    var s,state,c1;
    var ftext, plaintext;
    var keysq, inverse_left,inverse_top,lk,tk,cnt;
	
	alpha="ABCDEFGHIJKLMNOPQRSTUVWXYZ";
    key = document.getElementById('key_area').value;
    key = key.toUpperCase();
    if (key == ''){
        document.getElementById('output_area').value ="No key entered!";
        return;
    }
    str = get_key_square(key,basic_key)
    keysq =str[0];
    if ( str[1] == false) { // used non-keysquare symbol
        document.getElementById('output_area').value =keysq;
        return;
    }
    str = 'Keysquare:\n';
    for (n=0;n<keysq.length;n++){
        str += keysq[n]+' ';
    }
    lk = document.getElementById('left_key').value;
    inverse_left = [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];
    cnt = 0;
    //for c in left_key:
    for (i=0;i<lk.length;i++){
         n = digits.indexOf(lk.charAt(i));
         if (n != -1) {
            inverse_left[n] = cnt;
            cnt += 1;
        }
    }
    for (i=0;i<10;i++) {
        if (inverse_left[i] == -1) {
            document.getElementById('output_area').value ='Digit '+i+' missing from row key';
            return;
        }
    }
            
    //print inverse_left
    tk = document.getElementById('top_key').value;
    inverse_top = [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];
    cnt = 0;
    //for c in top_key:
    for (i=0;i<tk.length;i++){
         n = digits.indexOf(tk.charAt(i));
         if (n != -1) {
            inverse_top[n] = cnt;
            cnt += 1;
        }
    }
    for (i=0;i<10;i++) {
        if (inverse_top[i] == -1) {
            document.getElementById('output_area').value ='Digit '+i+' missing from column key';
            return;
        }
    }
    //print inverse_top
	
	str = document.getElementById('input_area').value;
	str = str.toUpperCase();
	// global replace of line feeds and carriage returns with blank
	str = str.replace(/[\n\r]/g,' ');		
    
    if (str == ''){
        document.getElementById('output_area').value ="No codetext entered!";
        return;
    }
    state = 0;
    plaintext = '';
	for (i=0;i<str.length;i++){
		c = str.charAt(i);
		n = digits.indexOf(c);
		if ( n>=0) {
            if (state == 0) {
                row = inverse_left[n];
                state = 1;
            }
            else {
                col = inverse_top[n];
                plaintext += keysq[10*row+col];
                state = 0;
            }
        }
	}
    if (state == 1) {
        document.getElementById('output_area').value ="Odd number of digits!";
        return;
    }
    
	plaintext = plaintext.toLowerCase();
    //ftext = 'Plaintext:\n'+do_format(plaintext,'');
    ftext = plaintext;
    if ( document.getElementById('show_work').checked){  
        s = "\n\nKey: "+key;
        // show worksheet
        s += show_worksheet(keysq);
        s += '\n\nworksheet:\n';
        s += do_format(keysq,str)
        ftext += s;
    }
	document.getElementById('output_area').value = ftext;

}

function do_clear(){
    document.getElementById('input_area').value = '';
    document.getElementById('key_area').value = '';
    document.getElementById('left_key').value = '';
    document.getElementById('top_key').value = '';
    document.getElementById('output_area').value = '';
}

function switch_basic_block(){
    if (document.getElementById('english').checked)
        basic_key = english_basic_key;
    else if (document.getElementById('french').checked)
        basic_key = french_basic_key;
    else if (document.getElementById('german').checked)
        basic_key = german_basic_key;
    else if (document.getElementById('italian').checked)
        basic_key = italian_basic_key;
    else if (document.getElementById('spanish').checked)
        basic_key = spanish_basic_key;
    else if (document.getElementById('latin').checked)
        basic_key = latin_basic_key;
}

</script>
</head>
<body >
<div style="background:silver; border:3px ridge black;padding:5px;">
<h3>Syllabary cipher encode-decode</h3>
<br>
<br>Codetext/Plaintext:<br>
<textarea id="input_area" cols=80 rows = 6>
</textarea><br>
<br>Key: 
<input type=text id="key_area" size = 30>
Symbols separated by blanks. "T E S T" is a different key from "TE ST" (Can leave out digits.)
<br>
<br>Row key
<input type=text name=left_key" id="left_key" size = 10 >
 (10 digits)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Column Key
<input type=text name=top_key" id="top_key" size = 10 >
 (10 digits)
<br>
<br>
Output:<br>
<textarea id="output_area" cols=80 rows = 6>
</textarea>
<br>
<input type="button" value="Encode" onclick=do_calc();>
<input type="button" value="Decode" onclick=do_decrypt();>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<input type="checkbox" id = "show_work"  checked > Show Worksheet
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<input type="button" value="clear" onclick=do_clear();>
<br><br>
Language:
<input type="radio" onclick="switch_basic_block()" id="english" name="lang"  checked > English
<input type="radio" onclick="switch_basic_block()" id="french" name="lang"  > French
<input type="radio" onclick="switch_basic_block()" id="german" name="lang"  > German
<input type="radio" onclick="switch_basic_block()" id="italian" name="lang"  > Italian
<input type="radio" onclick="switch_basic_block()" id="spanish" name="lang"  > Spanish
<input type="radio" onclick="switch_basic_block()" id="latin" name="lang"  > Latin
<br><br>
</div>
</body>
</html>
