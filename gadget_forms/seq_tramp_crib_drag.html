<html>
<head>
<title>Sequence tramp crib possibilities</title>
<link rel="shortcut icon" href="Bicon16_alt2.ico">  
<script type="text/javascript">
var upperC="ABCDEFGHIJKLMNOPQRSTUVWXYZ";

var primer;
var chain = [];

var digits="0123456789";
var buffer = [];
var buf_len, crib_len;
var crib = [];


function get_chain(){
    var i,j,k,index,n,c;

    chain = [];
    index = 0;
    for (i=0;i<primer.length;i++){
        c = primer.charAt(i);
        n = digits.indexOf(c);
        if ( n != -1)
            chain[index++] = n
    }
    for (j = 0;j<buf_len-index;j++) 
       chain[j+index] = (chain[j]+chain[j+1]) % 10;
}       



function setup_cipher() {
	var i,j,state,cnt,c, data,n1,n;
    var str;
    alpha="abcdefghijklmnopqrstuvwxyz";
    
    buffer = [];
    str = document.getElementById('cipher_area').value;    
	str = str.toLowerCase();
	buf_len = 0;
	for ( i=0;i<str.length;i++){
		c = str.charAt(i);
		n = alpha.indexOf(c);
		if ( n>=0)
			buffer[buf_len++] = n;
	}
}	



function do_calc(){
	var str, alpha,out_str,c,n,cnt,i,j;
    var start_pos, numb_symbols,flag;
    var temp1,temp2;
    
    setup_cipher();
    if ( buffer.length == 0){
        alert("no cipher entered!");
        return;
    }
    alpha="abcdefghijklmnopqrstuvwxyz";
    numb_symbols = 26;

	out_str="positions start at 0\n";
	
	str = document.getElementById('crib_area').value;
	str = str.toLowerCase();
    crib_len = 0;
    crib = [];
	for (var i=0;i<str.length;i++){
		c = str.charAt(i);
		n = alpha.indexOf(c);
		if ( n>=0)
			crib[crib_len++] = n;
	}
    if ( crib_len == 0){
        alert("No crib entered!");
        return;
    }
    str = document.getElementById('primer').value;
    primer = '';
    for (i=0;i<str.length;i++){
		c = str.charAt(i);
		n = digits.indexOf(c);
		if ( n>=0)
            primer += c;        
    }
    if (primer.length != 5){
        alert("Primer does not have 5 digits!");
        return;
    }
    get_chain();

        out_str += " OK at:";
        flag = false;
        for (start_pos = 0;start_pos<buf_len - crib_len+1;start_pos++){
            //n = check_text(start_pos,numb_symbols);
            n = test_pos(start_pos,crib_len);
            if ( n >= 0) {
                if ( flag) out_str += ","; 
                //out_str += " "+start_pos+","
                out_str += " "+start_pos;
                out_str += " ("+n+" letters in same digit column)";
                flag = true;

                if (document.getElementById('crib_string').checked){
                    out_str += '\n';
                    temp1 = '';
                    temp2 = '';
                    // add crib string you can paste into hill-climber
                    cnt = 0;
                    for (i=0;i<start_pos;i++){
                        //out_str += '-';
                        temp1 += '-';
                        temp2 += digits.charAt(chain[i]);
                        if (++cnt == 50){
                            out_str += temp1+'\n'+temp2
                            out_str += '\n';
                            temp1 = '';
                            temp2 = '';
                            cnt = 0;
                        }
                    }
                    for (i=0;i<crib.length;i++){
                        //out_str += alpha.charAt(crib[i]);
                        temp1 += alpha.charAt(crib[i]);
                        temp2 += digits.charAt(chain[start_pos+i]);
                        if (++cnt == 50){
                            out_str += temp1+'\n'+temp2
                            out_str += '\n';
                            temp1 = '';
                            temp2 = '';
                            cnt = 0;
                        }
                    }
                    for (i=start_pos+crib.length;i<buffer.length;i++){
                        //out_str += '-';
                        temp1 += '-';
                        temp2 += digits.charAt(chain[i]);                        
                        if (++cnt == 50){
                            out_str += temp1+'\n'+temp2
                            out_str += '\n';
                            temp1 = '';
                            temp2 = '';                            
                            cnt = 0;
                        }
                    }
                    out_str += temp1+'\n'+temp2
                    out_str += '\n\n';
                } 
            }                
        }
        
        out_str += "\n";

    document.getElementById('output_area').value = out_str;        
    
}

function test_pos(start_pos,crib_len){
	var j, count,nb,nc,n,k,i;
	var flag,n1,n2, flag2;
	var x,y;
    var chain_digits;
    var max_col_length;
// get crib letters corresponding to chain digits
	chain_digits = [];
    for (i=0;i<10;i++)
        chain_digits[i] = [];
    for (i=0;i<crib_len;i++){
        n = crib[i];
        j = chain_digits[ chain[start_pos+i] ].length; //number of letters that already have this chain digit
        chain_digits[ chain[start_pos+i] ] [ j ] = n;
    }
    // search ciphertext for string with same chain digits as crib
    max_col_length = 0;
    for (i=0;i<10;i++){
        if (chain_digits[i].length> max_col_length)
            max_col_length = chain_digits[i].length;
        if (chain_digits[i].length>1){ // at least 2 letters with this chain digit
                n1 = chain_digits[i][0];
                flag = true;
                // n1 & letters following must be at least a digraph in ciphertext if this crib position works.
                for (k=0;k<buf_len-chain_digits[i].length+1;k++) {
                    if ( buffer[k] == n1 ) {// possible match
                        flag2 = true;
                        for (x=1;x< chain_digits[i].length;x++)
                            if ( chain_digits[i][x] != buffer[k+x] ){
                                flag2 = false; // no match
                                break;
                        }
                        if ( flag2 ) {// have match
                            flag = false;
                            break;
                        }
                    }                    
                }
                if ( flag) // digraph doesn't exist in ciphertext, this position doesn't work
                    return(-1);
        }
    }

//return(0); /* OK */
return(max_col_length)
} /* end test_pos */



</script>
</head>
<body bgcolor="Silver">
<h3>Sequence transposition crib possibilities</h3> <br>
Directions: Type or paste in ciphertext, primer and crib. Click Crib Drag button. <br><br>
Ciphertext:<br>
<textarea id="cipher_area" rows = 5 cols=90 spellcheck="false" >
</textarea><br>
crib:<br>
<textarea id="crib_area" rows = 2 cols=90 >
</textarea><br>
<br>
<input type="button" value="Crib Drag" onclick=do_calc();>
&nbsp  &nbsp &nbsp Primer:
<input type = text id="primer" size = 5 >
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;
<input type="checkbox" id="crib_string"> Include crib string
<br><br>
Output:<br>
<textarea id="output_area" rows=12 cols=90>
</textarea>


</body>
</html>
